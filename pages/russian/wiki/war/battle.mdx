# Бой

Бой происходит, когда игрок решает атаковать клетку, принадлежащую другому игроку, или занятую варварскими войсками (NPC). Бои — это основной способ захвата новых клеток и устранения противников, поэтому это одно из важнейших действий в Duper.

Чтобы атаковать, выберите свою клетку и перетащите её на целевую клетку, которая должна мигать красным, если атака допустима. В отличие от перемещения, разделение войск невозможно — обычная атака использует все войска на исходной клетке, а дальняя атака — все самолёты на исходной клетке.

Результат боя зависит от суммарной силы обеих сторон. Если сила атаки превышает силу защиты, атака успешна: целевая клетка переходит к атакующему. В противном случае атака проваливается.

### Расчёт боя

$$
\text{attack strength} = \sum \text{attacking troop strength incl. supporting tanks}
$$

$$
\text{defense strength} = \left(\sum \text{defending troop strength incl. supporting tanks}\right) \newline + \, \text{defending building strength} + \text{tile buff} + \text{gem buff}
$$

Смотри [Таблица Юнитов](./units#unit-table) для силы каждого класса юнитов.

- Бонус защиты клетки у защитника: 1 для клетки 1 уровня, 2 для клетки 2 уровня и 4 для клетки 3 уровня.
- Бонус защиты от гемов у защитника: 2 × количество гемов, отчеканенных атакующим, которые принадлежат защитнику.
- Если на атакующей клетке есть форт, его сила включается в общую силу атаки.

Если атака успешна, все обороняющиеся юниты, включая поддерживающие танки, погибают, а атакующие получают урон, равный защите. Выжившие атакующие юниты, которые не являются поддерживающими, занимают теперь захваченную клетку.

Если атака неудачна, все атакующие юниты, включая поддерживающие танки, погибают, а обороняющиеся юниты получают урон, равный силе атаки минус бонусы клетки и бонусы от гемов.

> _Пример: Игрок A атакует игрока B. На атакующей клетке у игрока A: 8 пехотинцев (+8 силы атаки), 2 самолёта, загружающие 2 танка (+8 силы атаки, потому что загруженные юниты не учитываются в бою), 1 форт (+7 силы атаки). На соседних клетках: 3 танка (+9 силы атаки). У игрока B: 5 танков (+15 силы защиты) и 1 исследовательский центр с экономистом (+0 защиты) на атакуемой клетке, а на соседних клетках 4 танка (+12 защиты). Клетка защиты 3 уровня (+4 защиты), у игрока B есть 2 гема, отчеканенные игроком A (+2 защиты). Итог: сила атаки = 32, сила защиты = 33 → атака неудачна. Игрок A теряет 8 пехотинцев, 2 самолёта с загруженными танками, 1 форт и 3 поддерживающих танка. Урон для войск игрока B = 32-4-2=26. Танки на клетке защитника имеют приоритет смерти 2, поддерживающие — 4; сначала погибают танки на клетке, оставшийся урон = 11. Из этого 3 танка погибают, 1 остаётся в живых.

В боях с одной или двумя столицами, если столица одной или обеих сторон погибает, соответствующий игрок или оба игрока исключаются из игры, а все их клетки навсегда исчезают на оставшуюся сессию.

### Особые сценарии

- Когда танк или форт атакует или защищается, он не поддерживает соседний бой.
- Когда танк или форт поддерживает атаку/оборону, он не может сам атаковать и на него нельзя нападать.
- Если суммарная сила сторон равна, атака не удаётся, и атакующий не получает клетку. Однако если на защищаемой клетке есть столица или суперстолица, защитник погибает, и тогда атакующий получает клетку.
- Атака на столицу или суперстолицу, независимо от исхода, имеет 35% шанс украсть одну карту у защитника.